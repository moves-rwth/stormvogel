from lxml import etree
from svgpathtools import svg2paths2
import io
import re


def remove_invalid_paths(svg_string):
    # Remove <path> elements that have no 'd' attribute
    return re.sub(r"<path(?![^>]* d=)[^>]*/>", "", svg_string)


def autoscale_svg(raw_svg: str, target_width: float) -> str:
    # Parse the SVG from the raw string
    # Using lxml to parse the raw SVG string
    clean_svg = remove_invalid_paths(raw_svg)
    tree = etree.fromstring(clean_svg)  # type: ignore
    root = tree

    # Extract paths and calculate the bounding box using svgpathtools
    paths, attributes, svg_attr = svg2paths2(io.StringIO(clean_svg))  # type: ignore

    # Calculate the bounding box of all paths
    xmin, xmax, ymin, ymax = None, None, None, None
    for i, path in enumerate(paths):
        atr = attributes[i]
        if atr["stroke"] != "none" and "d" in atr:
            box = path.bbox()
            x0, x1, y0, y1 = box
            xmin = x0 if xmin is None else min(xmin, x0)
            xmax = x1 if xmax is None else max(xmax, x1)
            ymin = y0 if ymin is None else min(ymin, y0)
            ymax = y1 if ymax is None else max(ymax, y1)
    width = xmax - xmin  # type: ignore
    height = ymax - ymin  # type: ignore

    # Set the viewBox and the width/height attributes to match the content size
    root.attrib["viewBox"] = f"{xmin} {ymin} {width} {height}"
    root.attrib["width"] = str(width)
    root.attrib["height"] = str(height)

    # Now scale according to the provided target width while keeping the aspect ratio
    aspect_ratio = height / width
    new_width = target_width
    new_height = target_width * aspect_ratio

    # Update width and height attributes in the SVG
    root.attrib["width"] = str(new_width)
    root.attrib["height"] = str(new_height)

    # Return the modified SVG as a string
    return etree.tostring(
        root, pretty_print=True, xml_declaration=True, encoding="utf-8"
    ).decode()


BIG_SVG = r"""
<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="880.0000000000001" height="660"><defs/><g><g/><rect fill="#FFFFFF" stroke="none" x="0" y="0" width="800" height="600" transform="matrix(1.100000023841858 0 0 1.100000023841858 0 0)"/><g><path fill="none" stroke="none"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 118.9081348283533 361.509739284798 Q 175.46209707088047 306.72221139675304 234.03970519858223 259.55200403142686" stroke-miterlimit="10" stroke-dasharray=""/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 234.03970519858223 259.55200403142686 Q 267.6433667827731 195.98203426262077 267.1229754481841 125.1178095985546" stroke-miterlimit="10" stroke-dasharray=""/><g><text fill="none" stroke="white" font-family="arial" font-size="14px" font-style="normal" font-weight="normal" text-decoration="undefined" x="-138.10896947136317" y="-136.33577867767477" text-anchor="start" dominant-baseline="central" transform="matrix(1.100000023841858 0 0 1.100000023841858 406.74985012465913 344.12783033474625)" stroke-linejoin="round" stroke-miterlimit="10" stroke-width="2.200000047683716" stroke-dasharray="">1</text><text fill="black" stroke="none" font-family="arial" font-size="14px" font-style="normal" font-weight="normal" text-decoration="undefined" x="-138.10896947136317" y="-136.33577867767477" text-anchor="start" dominant-baseline="central" transform="matrix(1.100000023841858 0 0 1.100000023841858 406.74985012465913 344.12783033474625)">1</text></g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 118.9081348283533 361.509739284798 Q 119.45460835741738 456.7621954708691 171.55135323830922 529.9881882027635" stroke-miterlimit="10" stroke-dasharray=""/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 171.55135323830922 529.9881882027635 Q 254.95777621847984 561.5957939046475 344.2896817355293 534.5781265870969" stroke-miterlimit="10" stroke-dasharray=""/><g><text fill="none" stroke="white" font-family="arial" font-size="14px" font-style="normal" font-weight="normal" text-decoration="undefined" x="-140.53915732812536" y="184.3742190174715" text-anchor="start" dominant-baseline="central" transform="matrix(1.100000023841858 0 0 1.100000023841858 406.74985012465913 344.12783033474625)" stroke-linejoin="round" stroke-miterlimit="10" stroke-width="2.200000047683716" stroke-dasharray="">1</text><text fill="black" stroke="none" font-family="arial" font-size="14px" font-style="normal" font-weight="normal" text-decoration="undefined" x="-140.53915732812536" y="184.3742190174715" text-anchor="start" dominant-baseline="central" transform="matrix(1.100000023841858 0 0 1.100000023841858 406.74985012465913 344.12783033474625)">1</text></g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 344.2896817355293 534.5781265870969 Q 431.747765455206 536.9047825164894 495.81710278175814 483.9863117281766" stroke-miterlimit="10" stroke-dasharray=""/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 495.81710278175814 483.9863117281766 Q 516.6029411549088 403.2511379478575 505.32023750489725 315.6649590510672" stroke-miterlimit="10" stroke-dasharray=""/><g><text fill="none" stroke="white" font-family="arial" font-size="14px" font-style="normal" font-weight="normal" text-decoration="undefined" x="88.68507297304478" y="52.19141371786654" text-anchor="start" dominant-baseline="central" transform="matrix(1.100000023841858 0 0 1.100000023841858 406.74985012465913 344.12783033474625)" stroke-linejoin="round" stroke-miterlimit="10" stroke-width="2.200000047683716" stroke-dasharray="">1</text><text fill="black" stroke="none" font-family="arial" font-size="14px" font-style="normal" font-weight="normal" text-decoration="undefined" x="88.68507297304478" y="52.19141371786654" text-anchor="start" dominant-baseline="central" transform="matrix(1.100000023841858 0 0 1.100000023841858 406.74985012465913 344.12783033474625)">1</text></g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 344.2896817355293 534.5781265870969 Q 293.14607487012603 485.0507326209121 246.54666977637334 430.86924484550224" stroke-miterlimit="10" stroke-dasharray=""/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 246.54666977637334 430.86924484550224 Q 181.70501692956574 399.13202807974994 118.9081348283533 361.509739284798" stroke-miterlimit="10" stroke-dasharray=""/><g><text fill="none" stroke="white" font-family="arial" font-size="14px" font-style="normal" font-weight="normal" text-decoration="undefined" x="-208.01455335357647" y="48.66629870673529" text-anchor="start" dominant-baseline="central" transform="matrix(1.100000023841858 0 0 1.100000023841858 406.74985012465913 344.12783033474625)" stroke-linejoin="round" stroke-miterlimit="10" stroke-width="2.200000047683716" stroke-dasharray="">1</text><text fill="black" stroke="none" font-family="arial" font-size="14px" font-style="normal" font-weight="normal" text-decoration="undefined" x="-208.01455335357647" y="48.66629870673529" text-anchor="start" dominant-baseline="central" transform="matrix(1.100000023841858 0 0 1.100000023841858 406.74985012465913 344.12783033474625)">1</text></g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 267.1229754481841 125.1178095985546 Q 180.63595368146792 134.72718203516257 115.37282374522857 190.38853476397728" stroke-miterlimit="10" stroke-dasharray=""/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 115.37282374522857 190.38853476397728 Q 90.62657316159635 274.3169051537428 118.9081348283533 361.509739284798" stroke-miterlimit="10" stroke-dasharray=""/><g><text fill="none" stroke="white" font-family="arial" font-size="14px" font-style="normal" font-weight="normal" text-decoration="undefined" x="-279.2260821662635" y="-62.722552500235295" text-anchor="start" dominant-baseline="central" transform="matrix(1.100000023841858 0 0 1.100000023841858 406.74985012465913 344.12783033474625)" stroke-linejoin="round" stroke-miterlimit="10" stroke-width="2.200000047683716" stroke-dasharray="">1</text><text fill="black" stroke="none" font-family="arial" font-size="14px" font-style="normal" font-weight="normal" text-decoration="undefined" x="-279.2260821662635" y="-62.722552500235295" text-anchor="start" dominant-baseline="central" transform="matrix(1.100000023841858 0 0 1.100000023841858 406.74985012465913 344.12783033474625)">1</text></g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 267.1229754481841 125.1178095985546 Q 352.07607583697154 127.92276984280028 422.3136552129125 170.0549791886128" stroke-miterlimit="10" stroke-dasharray=""/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 422.3136552129125 170.0549791886128 Q 471.17920846071894 235.50427369642125 505.32023750489725 315.6649590510672" stroke-miterlimit="10" stroke-dasharray=""/><g><text fill="none" stroke="white" font-family="arial" font-size="14px" font-style="normal" font-weight="normal" text-decoration="undefined" x="51.332593565086746" y="-95.40518786543517" text-anchor="start" dominant-baseline="central" transform="matrix(1.100000023841858 0 0 1.100000023841858 406.74985012465913 344.12783033474625)" stroke-linejoin="round" stroke-miterlimit="10" stroke-width="2.200000047683716" stroke-dasharray="">1</text><text fill="black" stroke="none" font-family="arial" font-size="14px" font-style="normal" font-weight="normal" text-decoration="undefined" x="51.332593565086746" y="-95.40518786543517" text-anchor="start" dominant-baseline="central" transform="matrix(1.100000023841858 0 0 1.100000023841858 406.74985012465913 344.12783033474625)">1</text></g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 505.32023750489725 315.6649590510672 Q 434.11570554010234 334.78833231227065 395.4605460107992 390.7115774555414" stroke-miterlimit="10" stroke-dasharray=""/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 395.4605460107992 390.7115774555414 Q 379.26527301367565 463.7170244893048 344.2896817355293 534.5781265870969" stroke-miterlimit="10" stroke-dasharray=""/><g><text fill="none" stroke="white" font-family="arial" font-size="14px" font-style="normal" font-weight="normal" text-decoration="undefined" x="-33.14729911876266" y="108.23009576378107" text-anchor="start" dominant-baseline="central" transform="matrix(1.100000023841858 0 0 1.100000023841858 406.74985012465913 344.12783033474625)" stroke-linejoin="round" stroke-miterlimit="10" stroke-width="2.200000047683716" stroke-dasharray="">1</text><text fill="black" stroke="none" font-family="arial" font-size="14px" font-style="normal" font-weight="normal" text-decoration="undefined" x="-33.14729911876266" y="108.23009576378107" text-anchor="start" dominant-baseline="central" transform="matrix(1.100000023841858 0 0 1.100000023841858 406.74985012465913 344.12783033474625)">1</text></g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 505.32023750489725 315.6649590510672 Q 581.943359473491 298.4815095707402 654.9798401157631 288.52243251621604" stroke-miterlimit="10" stroke-dasharray=""/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 654.9798401157631 288.52243251621604 Q 726.3340915997804 282.8129579168045 794.971288162757 275.5856217368387" stroke-miterlimit="10" stroke-dasharray=""/><g><text fill="none" stroke="white" font-family="arial" font-size="14px" font-style="normal" font-weight="normal" text-decoration="undefined" x="286.02054344173365" y="-56.08576043262873" text-anchor="start" dominant-baseline="central" transform="matrix(1.100000023841858 0 0 1.100000023841858 406.74985012465913 344.12783033474625)" stroke-linejoin="round" stroke-miterlimit="10" stroke-width="2.200000047683716" stroke-dasharray="">1</text><text fill="black" stroke="none" font-family="arial" font-size="14px" font-style="normal" font-weight="normal" text-decoration="undefined" x="286.02054344173365" y="-56.08576043262873" text-anchor="start" dominant-baseline="central" transform="matrix(1.100000023841858 0 0 1.100000023841858 406.74985012465913 344.12783033474625)">1</text></g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 831.1529706061488 261.40393977028407 A 22.000000476837158 22.000000476837158 0 1 1 831.1529596061496 261.3819397734739" stroke-miterlimit="10" stroke-dasharray=""/><text fill="none" stroke="white" font-family="arial" font-size="14px" font-style="normal" font-weight="normal" text-decoration="undefined" x="376.07007947457186" y="-89.34567087052201" text-anchor="start" dominant-baseline="central" transform="matrix(1.100000023841858 0 0 1.100000023841858 406.74985012465913 344.12783033474625)" stroke-linejoin="round" stroke-miterlimit="10" stroke-width="2.200000047683716" stroke-dasharray="">1</text><text fill="black" stroke="none" font-family="arial" font-size="14px" font-style="normal" font-weight="normal" text-decoration="undefined" x="376.07007947457186" y="-89.34567087052201" text-anchor="start" dominant-baseline="central" transform="matrix(1.100000023841858 0 0 1.100000023841858 406.74985012465913 344.12783033474625)">1</text><path fill="white" stroke="black" paint-order="stroke fill markers" d=" M 50.006668491204266 361.509739284798 C 50.006668491204266 353.00455318045306 80.85490227263415 346.109738951012 118.9081348283533 346.109738951012 C 156.96136738407236 346.109738951012 187.8096011655023 353.00455318045306 187.8096011655023 361.509739284798 C 187.8096011655023 370.01492538914295 156.96136738407236 376.909739618584 118.9081348283533 376.909739618584 C 80.85490227263415 376.909739618584 50.006668491204266 370.01492538914295 50.006668491204266 361.509739284798 Z" stroke-linejoin="round" stroke-miterlimit="10" stroke-dasharray=""/><g fill="white"/><g stroke="black" stroke-linejoin="round" stroke-miterlimit="10" stroke-dasharray=""/><text fill="black" stroke="none" font-family="arial" font-size="14px" font-style="normal" font-weight="normal" text-decoration="undefined" x="-317.311976273868" y="15.801735066644595" text-anchor="start" dominant-baseline="central" transform="matrix(1.100000023841858 0 0 1.100000023841858 406.74985012465913 344.12783033474625)">init,green light,still</text><path fill="white" stroke="black" paint-order="stroke fill markers" d=" M 295.9353349843521 534.5781265870969 C 295.9353349843521 526.0729404827521 317.58431101092475 519.1781262533109 344.2896817355293 519.1781262533109 C 370.9950524601339 519.1781262533109 392.64402848670653 526.0729404827521 392.64402848670653 534.5781265870969 C 392.64402848670653 543.083312691442 370.9950524601339 549.9781269208829 344.2896817355293 549.9781269208829 C 317.58431101092475 549.9781269208829 295.9353349843521 543.083312691442 295.9353349843521 534.5781265870969 Z" stroke-linejoin="round" stroke-miterlimit="10" stroke-dasharray=""/><g fill="white"/><g stroke="black" stroke-linejoin="round" stroke-miterlimit="10" stroke-dasharray=""/><text fill="black" stroke="none" font-family="arial" font-size="14px" font-style="normal" font-weight="normal" text-decoration="undefined" x="-93.74046612587924" y="173.1366292040471" text-anchor="start" dominant-baseline="central" transform="matrix(1.100000023841858 0 0 1.100000023841858 406.74985012465913 344.12783033474625)">red light,still</text><path fill="white" stroke="black" paint-order="stroke fill markers" d=" M 196.50329618316877 125.1178095985546 C 196.50329618316877 116.61262349420966 228.12080000924095 109.71780926476859 267.1229754481841 109.71780926476859 C 306.1251508871272 109.71780926476859 337.7426547131994 116.61262349420966 337.7426547131994 125.1178095985546 C 337.7426547131994 133.62299570289954 306.1251508871272 140.5178099323406 267.1229754481841 140.5178099323406 C 228.12080000924095 140.5178099323406 196.50329618316877 133.62299570289954 196.50329618316877 125.1178095985546 Z" stroke-linejoin="round" stroke-miterlimit="10" stroke-dasharray=""/><g fill="white"/><g stroke="black" stroke-linejoin="round" stroke-miterlimit="10" stroke-dasharray=""/><text fill="black" stroke="none" font-family="arial" font-size="14px" font-style="normal" font-weight="normal" text-decoration="undefined" x="-184.1332267131992" y="-199.10001453570672" text-anchor="start" dominant-baseline="central" transform="matrix(1.100000023841858 0 0 1.100000023841858 406.74985012465913 344.12783033474625)">green light,moving</text><path fill="white" stroke="black" paint-order="stroke fill markers" d=" M 443.26530451926783 315.6649590510672 C 443.26530451926783 307.1597729467223 471.0482412519155 300.2649587172812 505.32023750489725 300.2649587172812 C 539.592233757879 300.2649587172812 567.3751704905267 307.1597729467223 567.3751704905267 315.6649590510672 C 567.3751704905267 324.1701451554122 539.592233757879 331.06495938485324 505.32023750489725 331.06495938485324 C 471.0482412519155 331.06495938485324 443.26530451926783 324.1701451554122 443.26530451926783 315.6649590510672 Z" stroke-linejoin="round" stroke-miterlimit="10" stroke-dasharray=""/><g fill="white"/><g stroke="black" stroke-linejoin="round" stroke-miterlimit="10" stroke-dasharray=""/><text fill="black" stroke="none" font-family="arial" font-size="14px" font-style="normal" font-weight="normal" text-decoration="undefined" x="40.19586691196139" y="-25.875336969784488" text-anchor="start" dominant-baseline="central" transform="matrix(1.100000023841858 0 0 1.100000023841858 406.74985012465913 344.12783033474625)">red light,moving</text><path fill="white" stroke="black" paint-order="stroke fill markers" d=" M 758.5917951867527 275.5856217368387 C 758.5917951867527 267.08043563249373 774.8794471604031 260.18562140305266 794.971288162757 260.18562140305266 C 815.0631291651109 260.18562140305266 831.3507811387612 267.08043563249373 831.3507811387612 275.5856217368387 C 831.3507811387612 284.0908078411836 815.0631291651109 290.9856220706247 794.971288162757 290.9856220706247 C 774.8794471604031 290.9856220706247 758.5917951867527 284.0908078411836 758.5917951867527 275.5856217368387 Z" stroke-linejoin="round" stroke-miterlimit="10" stroke-dasharray=""/><g fill="white"/><g stroke="black" stroke-linejoin="round" stroke-miterlimit="10" stroke-dasharray=""/><text fill="black" stroke="none" font-family="arial" font-size="14px" font-style="normal" font-weight="normal" text-decoration="undefined" x="326.8563067601137" y="-62.31109737481387" text-anchor="start" dominant-baseline="central" transform="matrix(1.100000023841858 0 0 1.100000023841858 406.74985012465913 344.12783033474625)">accident</text><path fill="lightblue" stroke="black" paint-order="stroke fill markers" d=" M 199.61367906179322 246.35200374532457 L 268.46573133537123 246.35200374532457 L 268.46573133537123 246.35200374532457 A 6.6000001430511475 6.6000001430511475 0 0 1 275.0657314784224 252.9520038883757 L 275.0657314784224 266.152004174478 L 275.0657314784224 266.152004174478 A 6.6000001430511475 6.6000001430511475 0 0 1 268.46573133537123 272.75200431752916 L 199.61367906179322 272.75200431752916 L 199.61367906179322 272.75200431752916 A 6.6000001430511475 6.6000001430511475 0 0 1 193.01367891874207 266.152004174478 L 193.01367891874207 252.9520038883757 L 193.01367891874207 252.9520038883757 A 6.6000001430511475 6.6000001430511475 0 0 1 199.61367906179322 246.35200374532457 Z" stroke-linejoin="round" stroke-miterlimit="10" stroke-dasharray=""/><g fill="lightblue"/><g stroke="black" stroke-linejoin="round" stroke-miterlimit="10" stroke-dasharray=""/><text fill="black" stroke="none" font-family="arial" font-size="14px" font-style="normal" font-weight="normal" text-decoration="undefined" x="-189.30560597573674" y="-76.88711315471613" text-anchor="start" dominant-baseline="central" transform="matrix(1.100000023841858 0 0 1.100000023841858 406.74985012465913 344.12783033474625)">accelerate</text><path fill="lightblue" stroke="black" paint-order="stroke fill markers" d=" M 158.95828655911185 516.7881879166612 L 184.14441991750658 516.7881879166612 L 184.14441991750658 516.7881879166612 A 6.6000001430511475 6.6000001430511475 0 0 1 190.74442006055773 523.3881880597123 L 190.74442006055773 536.5881883458146 L 190.74442006055773 536.5881883458146 A 6.6000001430511475 6.6000001430511475 0 0 1 184.14441991750658 543.1881884888658 L 158.95828655911185 543.1881884888658 L 158.95828655911185 543.1881884888658 A 6.6000001430511475 6.6000001430511475 0 0 1 152.3582864160607 536.5881883458146 L 152.3582864160607 523.3881880597123 L 152.3582864160607 523.3881880597123 A 6.6000001430511475 6.6000001430511475 0 0 1 158.95828655911185 516.7881879166612 Z" stroke-linejoin="round" stroke-miterlimit="10" stroke-dasharray=""/><g fill="lightblue"/><g stroke="black" stroke-linejoin="round" stroke-miterlimit="10" stroke-dasharray=""/><text fill="black" stroke="none" font-family="arial" font-size="14px" font-style="normal" font-weight="normal" text-decoration="undefined" x="-226.26505290437262" y="168.96395803600228" text-anchor="start" dominant-baseline="central" transform="matrix(1.100000023841858 0 0 1.100000023841858 406.74985012465913 344.12783033474625)">wait</text><path fill="lightblue" stroke="black" paint-order="stroke fill markers" d=" M 461.39107664496913 470.7863114420743 L 530.2431289185472 470.7863114420743 L 530.2431289185472 470.7863114420743 A 6.6000001430511475 6.6000001430511475 0 0 1 536.8431290615983 477.38631158512544 L 536.8431290615983 490.58631187122774 L 536.8431290615983 490.58631187122774 A 6.6000001430511475 6.6000001430511475 0 0 1 530.2431289185472 497.1863120142789 L 461.39107664496913 497.1863120142789 L 461.39107664496913 497.1863120142789 A 6.6000001430511475 6.6000001430511475 0 0 1 454.791076501918 490.58631187122774 L 454.791076501918 477.38631158512544 L 454.791076501918 477.38631158512544 A 6.6000001430511475 6.6000001430511475 0 0 1 461.39107664496913 470.7863114420743 Z" stroke-linejoin="round" stroke-miterlimit="10" stroke-dasharray=""/><g fill="lightblue"/><g stroke="black" stroke-linejoin="round" stroke-miterlimit="10" stroke-dasharray=""/><text fill="black" stroke="none" font-family="arial" font-size="14px" font-style="normal" font-weight="normal" text-decoration="undefined" x="48.673841214539394" y="127.14407123825407" text-anchor="start" dominant-baseline="central" transform="matrix(1.100000023841858 0 0 1.100000023841858 406.74985012465913 344.12783033474625)">accelerate</text><path fill="lightblue" stroke="black" paint-order="stroke fill markers" d=" M 233.95360309717597 417.66924455939994 L 259.1397364555707 417.66924455939994 L 259.1397364555707 417.66924455939994 A 6.6000001430511475 6.6000001430511475 0 0 1 265.73973659862185 424.2692447024511 L 265.73973659862185 437.4692449885534 L 265.73973659862185 437.4692449885534 A 6.6000001430511475 6.6000001430511475 0 0 1 259.1397364555707 444.06924513160453 L 233.95360309717597 444.06924513160453 L 233.95360309717597 444.06924513160453 A 6.6000001430511475 6.6000001430511475 0 0 1 227.35360295412482 437.4692449885534 L 227.35360295412482 424.2692447024511 L 227.35360295412482 424.2692447024511 A 6.6000001430511475 6.6000001430511475 0 0 1 233.95360309717597 417.66924455939994 Z" stroke-linejoin="round" stroke-miterlimit="10" stroke-dasharray=""/><g fill="lightblue"/><g stroke="black" stroke-linejoin="round" stroke-miterlimit="10" stroke-dasharray=""/><text fill="black" stroke="none" font-family="arial" font-size="14px" font-style="normal" font-weight="normal" text-decoration="undefined" x="-158.08749389293223" y="78.85582966426045" text-anchor="start" dominant-baseline="central" transform="matrix(1.100000023841858 0 0 1.100000023841858 406.74985012465913 344.12783033474625)">wait</text><path fill="lightblue" stroke="black" paint-order="stroke fill markers" d=" M 97.21154405471844 177.18853447787498 L 133.5341034357387 177.18853447787498 L 133.5341034357387 177.18853447787498 A 6.6000001430511475 6.6000001430511475 0 0 1 140.13410357878985 183.78853462092613 L 140.13410357878985 196.98853490702842 L 140.13410357878985 196.98853490702842 A 6.6000001430511475 6.6000001430511475 0 0 1 133.5341034357387 203.58853505007957 L 97.21154405471844 203.58853505007957 L 97.21154405471844 203.58853505007957 A 6.6000001430511475 6.6000001430511475 0 0 1 90.6115439116673 196.98853490702842 L 90.6115439116673 183.78853462092613 L 90.6115439116673 183.78853462092613 A 6.6000001430511475 6.6000001430511475 0 0 1 97.21154405471844 177.18853447787498 Z" stroke-linejoin="round" stroke-miterlimit="10" stroke-dasharray=""/><g fill="lightblue"/><g stroke="black" stroke-linejoin="round" stroke-miterlimit="10" stroke-dasharray=""/><text fill="black" stroke="none" font-family="arial" font-size="14px" font-style="normal" font-weight="normal" text-decoration="undefined" x="-282.3984539644352" y="-139.76299294414505" text-anchor="start" dominant-baseline="central" transform="matrix(1.100000023841858 0 0 1.100000023841858 406.74985012465913 344.12783033474625)">brake</text><path fill="lightblue" stroke="black" paint-order="stroke fill markers" d=" M 409.72058853371516 156.8549789025105 L 434.9067218921099 156.8549789025105 L 434.9067218921099 156.8549789025105 A 6.6000001430511475 6.6000001430511475 0 0 1 441.50672203516103 163.45497904556166 L 441.50672203516103 176.65497933166395 L 441.50672203516103 176.65497933166395 A 6.6000001430511475 6.6000001430511475 0 0 1 434.9067218921099 183.2549794747151 L 409.72058853371516 183.2549794747151 L 409.72058853371516 183.2549794747151 A 6.6000001430511475 6.6000001430511475 0 0 1 403.120588390664 176.65497933166395 L 403.120588390664 163.45497904556166 L 403.120588390664 163.45497904556166 A 6.6000001430511475 6.6000001430511475 0 0 1 409.72058853371516 156.8549789025105 Z" stroke-linejoin="round" stroke-miterlimit="10" stroke-dasharray=""/><g fill="lightblue"/><g stroke="black" stroke-linejoin="round" stroke-miterlimit="10" stroke-dasharray=""/><text fill="black" stroke="none" font-family="arial" font-size="14px" font-style="normal" font-weight="normal" text-decoration="undefined" x="1.7006712224245408" y="-158.248043066551" text-anchor="start" dominant-baseline="central" transform="matrix(1.100000023841858 0 0 1.100000023841858 406.74985012465913 344.12783033474625)">wait</text><path fill="lightblue" stroke="black" paint-order="stroke fill markers" d=" M 377.29926632028906 377.5115771694391 L 413.6218257013093 377.5115771694391 L 413.6218257013093 377.5115771694391 A 6.6000001430511475 6.6000001430511475 0 0 1 420.22182584436047 384.1115773124902 L 420.22182584436047 397.3115775985925 L 420.22182584436047 397.3115775985925 A 6.6000001430511475 6.6000001430511475 0 0 1 413.6218257013093 403.91157774164367 L 377.29926632028906 403.91157774164367 L 377.29926632028906 403.91157774164367 A 6.6000001430511475 6.6000001430511475 0 0 1 370.6992661772379 397.3115775985925 L 370.6992661772379 384.1115773124902 L 370.6992661772379 384.1115773124902 A 6.6000001430511475 6.6000001430511475 0 0 1 377.29926632028906 377.5115771694391 Z" stroke-linejoin="round" stroke-miterlimit="10" stroke-dasharray=""/><g fill="lightblue"/><g stroke="black" stroke-linejoin="round" stroke-miterlimit="10" stroke-dasharray=""/><text fill="black" stroke="none" font-family="arial" font-size="14px" font-style="normal" font-weight="normal" text-decoration="undefined" x="-27.773257423678054" y="42.34886010101782" text-anchor="start" dominant-baseline="central" transform="matrix(1.100000023841858 0 0 1.100000023841858 406.74985012465913 344.12783033474625)">brake</text><path fill="lightblue" stroke="black" paint-order="stroke fill markers" d=" M 642.3867734365657 275.3224322301137 L 667.5729067949604 275.3224322301137 L 667.5729067949604 275.3224322301137 A 6.6000001430511475 6.6000001430511475 0 0 1 674.1729069380116 281.9224323731649 L 674.1729069380116 295.1224326592672 L 674.1729069380116 295.1224326592672 A 6.6000001430511475 6.6000001430511475 0 0 1 667.5729067949604 301.72243280231834 L 642.3867734365657 301.72243280231834 L 642.3867734365657 301.72243280231834 A 6.6000001430511475 6.6000001430511475 0 0 1 635.7867732935146 295.1224326592672 L 635.7867732935146 281.9224323731649 L 635.7867732935146 281.9224323731649 A 6.6000001430511475 6.6000001430511475 0 0 1 642.3867734365657 275.3224322301137 Z" stroke-linejoin="round" stroke-miterlimit="10" stroke-dasharray=""/><g fill="lightblue"/><g stroke="black" stroke-linejoin="round" stroke-miterlimit="10" stroke-dasharray=""/><text fill="black" stroke="none" font-family="arial" font-size="14px" font-style="normal" font-weight="normal" text-decoration="undefined" x="213.21538018601265" y="-50.55036055755974" text-anchor="start" dominant-baseline="central" transform="matrix(1.100000023841858 0 0 1.100000023841858 406.74985012465913 344.12783033474625)">wait</text><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 217.14938785919048 273.34626245617574 L 205.79355194297662 290.6196121361888 L 203.49428993424004 284.7957477907023 L 198.1605617199589 281.51621351955515 Z"/><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 266.82858873987635 140.53209837031622 L 271.14515941876425 160.7482017559379 L 265.38507103059305 158.29353610459074 L 259.3042009292478 159.78585661641574 Z"/><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 162.05186414213352 515.7705332113503 L 146.9987135453548 501.60274313545347 L 153.1321098149696 500.34359584489397 L 157.2833384563257 495.6562402506775 Z"/><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 305.14664979630726 543.6482644100616 L 286.2138300950892 551.9471773922025 L 287.4583523318354 545.8107968546469 L 284.77214179869895 540.1549790825546 Z"/><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 477.33508006251225 497.77713767641933 L 463.4848332626882 513.122960629521 L 462.0978375696874 507.01720558636345 L 457.3247879893921 502.9647989676379 Z"/><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 507.0558034022499 331.00804467653734 L 514.47937761549 350.3008973537465 L 508.4063965848825 348.7767900408154 L 502.6335473726379 351.2012928088349 Z"/><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 258.6360890908474 444.76057341750965 L 276.2482893932547 455.58342050281317 L 270.4973840992278 458.05952429679695 L 267.3823221403965 463.4909505084001 Z"/><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 143.5161687128599 375.9814481635482 L 163.6610973180003 380.61884722097 L 159.0008824735227 384.80052144342665 L 157.78171513141464 390.9419897280785 Z"/><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 133.08271426167886 176.41580620127257 L 146.17519951766468 160.41860493524564 L 147.85563267655454 166.45020058631104 L 152.81893659430568 170.26721721182943 Z"/><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 114.34639379366581 346.20809111553643 L 104.00004271489075 328.31181670216455 L 110.2365572071638 328.86849316755115 L 115.55977468021428 325.57192564449656 Z"/><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 402.2683308371497 158.9830070232932 L 381.8149042154917 155.98618237770057 L 386.12251312597334 151.44211952890691 L 386.84216254508254 145.22230390358303 Z"/><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 498.65056794948646 300.45644579525566 L 484.8826509653345 285.0367155628074 L 491.10212930455464 284.31415699257263 L 495.64417683378986 280.0044231328528 Z"/><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 406.3024663541454 376.50608429821733 L 415.5357429009341 358.01094378146263 L 418.50763775931387 363.52200925468867 L 424.19179292995324 366.1477247182416 Z"/><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 351.5872542070912 519.3293171023139 L 354.2205940899596 498.8259237347449 L 358.84039375188496 503.05220493493994 L 365.07200220154226 503.6613500979407 Z"/><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 634.6546579733462 291.4234441722928 L 615.9978072159172 300.32544048430054 L 617.044837160568 294.15229460926633 L 614.1785735912681 288.5855599424484 Z"/><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 759.3996384207503 279.21132881613113 L 740.2639305231148 287.03106677723673 L 741.6625133222453 280.9279554515747 L 739.1195127661525 275.2063167115668 Z"/><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 829.2217666155377 270.417453434515 L 825.4500422614051 250.09264804995053 L 831.1420836202285 252.70122368981419 L 837.2608620912056 251.37285938641102 Z"/><path fill="none" stroke="none"/></g></g></svg>
"""

if __name__ == "__main__":
    example_svg = """
<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100">
  <circle cx="50" cy="50" r="40" fill="red" />
</svg>
"""
    res = autoscale_svg(BIG_SVG, 800)
    with open("res.svg", "w+") as f:
        f.write(res)
